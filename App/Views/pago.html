<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../Public/css/calificacionIn.css">
    <link rel="stylesheet" href="../../Public/css/responsive.css">
    <script src="https://kit.fontawesome.com/58f9dcf30d.js" crossorigin="anonymous"></script>
    <title>Ingresar Pago</title>

    <style>
        .content {
            display: none;
        }
    </style>
</head>
<header>
    <section class="navhead">
        <button class="abrirmenu" id="abrir"><i class="fa-solid fa-bars fa-xl" style="color: #ffffff;"></i></button>
    </section>
    <nav class="navbar" id="nav">
        <button class="cerrarmenu" id="cerrar"><i class="fa-solid fa-right-from-bracket fa-xl" style="color: #ffffff;"></i></button>
        <div class="menu1">
            <ul class="listmenu1">
                <li><a href="/" class="inicioa">Inicio</a></li>
                <li><a href="/horarios" class="inicioa">Horarios</a></li>
                <li><a href="/planes" class="inicioa">Planes</a></li>
                <li><a href="/">Nosotros</a></li>
            </ul>
        </div>
        <div class="menu2">
            <ul class="listmenu2" id="welcome-message">
            </ul>
        </div>
    </nav>
</header>
<body>
<div class="content">
    <h4>Ingresar Pago</h4>
    <form id="miFormulario" class="califidepo">
        <label for="selectPlan">Seleccionar Plan</label>
        <select id="selectPlan" name="nombrePlan" required>
            <option value="" disabled selected>Seleccione un plan</option>
        </select>

        <label for="descripcion">Descripción del Plan</label>
        <input type="text" id="descripcion" name="descripcionPlan" placeholder="Descripción" readonly>

        <label for="tipo">Tipo de Plan</label>
        <input type="text" id="tipo" name="tipoPlan" placeholder="Tipo de Plan" readonly>

        <input type="text" id="documento" name="nroDocumento" placeholder="Numero de Documento" required>
        <input name="fechaPago" type="date" placeholder="Fecha del Pago">
        <input name="ultimoMesAbonado" type="text" placeholder="Ultimo mes de Abono">
        <input type="submit">
    </form>
</div>

<footer class="footer">
    <h1>Gracias por elegirnos!</h1>
    <h2>Nuestras Redes</h2>
    <div class="redes">
        <a href="https://www.instagram.com/fidatdevs/" class="ig-logo">

        </a>
        <a href="https://github.com/Proyecto3Fidat/ProyectoEgreso" class="github-logo">

        </a>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/verificarsesion', {
            method: 'GET'
        })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    window.location.href = '/login';
                } else {
                    document.querySelector('.content').style.display = 'block';
                }
            })
            .catch(error => {
                alert('Error al verificar la sesión. Intente nuevamente.');
                console.error('Error:', error);
                window.location.href = '/login';
            });

        const urlParams = new URLSearchParams(window.location.search);
        const documento = urlParams.get('documento');

        if (documento) {
            document.getElementById('documento').value = documento;
        }

        fetch('/tiposDePlan')
            .then(response => response.json())
            .then(planes => {
                const selectPlan = document.getElementById('selectPlan');

                // Llenar el select con las opciones
                planes.forEach(plan => {
                    const option = document.createElement('option');
                    option.value = plan.nombre;
                    option.textContent = plan.nombre;
                    option.setAttribute('data-descripcion', plan.descripcion);
                    option.setAttribute('data-tipo', plan.tipo);
                    selectPlan.appendChild(option);
                });

                selectPlan.addEventListener('change', function () {
                    const selectedOption = this.options[this.selectedIndex];
                    const descripcion = selectedOption.getAttribute('data-descripcion');
                    const tipo = selectedOption.getAttribute('data-tipo');

                    document.getElementById('descripcion').value = descripcion;
                    document.getElementById('tipo').value = tipo;
                });
            })
            .catch(error => console.error('Error al obtener los planes:', error));
    });
</script>

<script src="../../Public/js/ingresarPago.js"></script>
<script src="../../Public/js/responsive.js"></script>
</body>
</html>
